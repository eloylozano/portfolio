---

---

<nav class="scroll-nav">
  <a href="#home" data-section="home" class="line" aria-label="Home section"
  ></a>
  <a href="#about" data-section="about" class="line" aria-label="About section"
  ></a>
  <a
    href="#projects"
    data-section="projects"
    class="line"
    aria-label="Projects section"></a>
  <a
    href="#recommendations"
    data-section="recommendations"
    class="line"
    aria-label="recommendations section"></a>
  <a
    href="#contact"
    data-section="contact"
    class="line"
    aria-label="Contact section"></a>
</nav>

<style>
  .scroll-nav {
    position: fixed;
    top: 50%;
    right: 2rem;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    z-index: 30;
  }
  @media (max-width: 767px) {
    .scroll-nav {
      display: none;
    }
  }
  .scroll-nav .line {
    width: 3px;
    height: 30px;
    border-radius: 4px;
    background: #666;
    transform: scaleY(0.15);
    transform-origin: center;
    transition:
      transform 0.3s ease,
      background 0.3s,
      box-shadow 0.3s;
    cursor: pointer;
  }

  .scroll-nav .line.active {
    transform: scaleY(1);
    background: #e9eeef;
    box-shadow:
      0 0 8px #e9eeef,
      0 0 20px #e9eeef,
      0 0 30px #ffffffaa;
  }
</style>

<script>
  function setupScrollSpy() {
    const sections = [
      "home",
      "about",
      "projects",
      "recommendations",
      "contact",
    ];
    const navLines = document.querySelectorAll(".scroll-nav .line");

    const observerOptions = {
      root: null,
      // El rootMargin crea una "línea de detección" invisible.
      // Aquí estamos diciendo que detecte lo que pase por el centro de la pantalla.
      rootMargin: "-20% 0px -79% 0px",
      threshold: 0,
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        // Dentro de tu IntersectionObserver en ScrollSpy.astro
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute("id");

          navLines.forEach((link) => {
            link.classList.toggle("active", link.getAttribute("data-section") === id);
          });

          // CAMBIO AQUÍ: Nombre del evento "section-selected" y propiedad "id"
          window.dispatchEvent(
            new CustomEvent("section-selected", { detail: { id: id } })
          );
        }
      });
    }, observerOptions);

    sections.forEach((id) => {
      const section = document.getElementById(id);
      if (section) observer.observe(section);
    });
  }

  // Ejecutar al cargar
  setupScrollSpy();
  // Ejecutar tras navegación de Astro
  document.addEventListener("astro:after-swap", setupScrollSpy);
</script>
