---
const lang =
  Astro.request.headers.get("cookie")?.match(/preferredLang=([^;]+)/)?.[1] ||
  "es";

import { t } from "../../i18n";
import Subtitle from "../ui/Subtitle.astro";
---

<div
  class="max-w-[32rem] w-full mx-auto mt-10 md:mt-20 rounded-3xl p-1 bg-gradient-to-b from-white/10 to-transparent shadow-2xl"
>
  <div
    class="bg-[#1a1a1a]/95 backdrop-blur-md rounded-[calc(1.5rem-1px)] p-6 sm:p-10 border border-white/5"
  >
    <Subtitle
      text={t(lang, "settings.settings")}
      class="mb-8 text-left border-b border-white/10 pb-4"
    />

    <div class="space-y-8">
      <div class="flex items-center justify-between group">
        <div class="flex flex-col">
          <span class="text-[#e9eeef] font-medium tracking-wide">
            {t(lang, "settings.language")}
          </span>
        </div>

        <div class="flex bg-black/40 p-1 rounded-xl border border-white/10">
          {
            ["en", "es", "de"].map((l) => (
              <button
                data-lang={l}
                class={`px-4 py-1.5 rounded-lg text-xs cursor-pointer font-bold transition-all duration-300 uppercase ${
                  lang === l
                    ? "bg-[#daa032] text-black shadow-[0_0_15px_rgba(218,160,50,0.4)]"
                    : "text-white/40 hover:text-white"
                }`}
              >
                {l}
              </button>
            ))
          }
        </div>
      </div>

      <div class="flex items-center justify-between group pt-2">
        <div class="flex flex-col">
          <span class="text-[#e9eeef] font-medium tracking-wide">
            {lang === "es" ? "Privacidad y Cookies" : "Privacy & Cookies"}
          </span>
          <span class="text-white/30 text-[10px] uppercase tracking-widest mt-1"
            >{
              lang === "es" ? "Gestionar preferencias" : "Manage preferences"
            }</span
          >
        </div>

        <button
          id="trigger-cookie-modal"
          class="px-4 py-2 bg-white/5 border border-white/10 rounded-xl text-[10px] font-bold text-[#daa032] hover:bg-[#daa032]/10 hover:border-[#daa032]/50 transition-all uppercase tracking-widest cursor-pointer"
        >
          {lang === "es" ? "Configurar" : "Configure"}
        </button>
      </div>

      <div class="flex items-center justify-between group">
        <div class="flex flex-col">
          <span class="text-[#e9eeef] font-medium tracking-wide">
            {t(lang, "settings.downloadCV")}
          </span>
        </div>

        <a
          href="/EloyLozanoBarrios.pdf"
          download
          class="p-3 bg-white/5 rounded-xl border border-white/10 hover:bg-[#daa032]/10 hover:border-[#daa032]/50 transition-all duration-300 group"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            class="fill-[#e9eeef] group-hover:fill-[#daa032] transition-colors"
          >
            <path
              d="m12 16l-5-5l1.4-1.45l2.6 2.6V4h2v8.15l2.6-2.6L17 11zm-6 4q-.825 0-1.412-.587T4 18v-3h2v3h12v-3h2v3q0 .825-.587 1.413T18 20z"
            ></path>
          </svg>
        </a>
      </div>

      <div class="pt-6 border-t border-white/10">
        <p class="text-[10px] text-white/30 uppercase tracking-widest mb-4">
          Social Connect
        </p>
        <div class="flex gap-4">
          {
            [
              {
                href: "https://github.com/eloylozano",
                icon: "M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2",
              },
              {
                href: "https://www.linkedin.com/in/eloylozano/",
                icon: "M6.94 5a2 2 0 1 1-4-.002a2 2 0 0 1 4 .002M7 8.48H3V21h4zm6.32 0H9.34V21h3.94v-6.57c0-3.66 4.77-4 4.77 0V21H22v-7.93c0-6.17-7.06-5.94-8.72-2.91z",
              },
              {
                href: "https://www.instagram.com/eloyloozano/",
                icon: "M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4zm9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8A1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5a5 5 0 0 1-5 5a5 5 0 0 1-5-5a5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3",
              },
            ].map((social) => (
              <a
                href={social.href}
                target="_blank"
                class="hover:-translate-y-1 transition-all duration-300 p-2 bg-white/5 rounded-lg border border-white/10 hover:border-[#daa032]/50 group"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 fill-[#e9eeef] group-hover:fill-[#daa032] transition-colors"
                  viewBox="0 0 24 24"
                >
                  <path d={social.icon} />
                </svg>
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function setupSettings() {
    // 1. LÓGICA DE IDIOMAS
    const langButtons = document.querySelectorAll("button[data-lang]");
    langButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const selectedLang = (btn as HTMLElement).dataset.lang;
        if (!selectedLang) return;
        document.cookie = `preferredLang=${selectedLang}; path=/; max-age=31536000; SameSite=Lax`;
        window.location.reload();
      });
    });

    // 2. LÓGICA PARA ABRIR EL MODAL DE COOKIES
    const triggerModal = document.getElementById("trigger-cookie-modal");
    triggerModal?.addEventListener("click", () => {
      // Disparamos el evento que escucha nuestro componente CookieModal
      window.dispatchEvent(new Event("open-cookie-modal"));
    });
  }

  // Inicialización
  setupSettings();
  document.addEventListener("astro:after-swap", setupSettings);
</script>
