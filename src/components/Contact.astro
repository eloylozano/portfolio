---
import Title from "./Title.astro";
import { t } from "../i18n";

const lang =
  Astro.request.headers.get("cookie")?.match(/preferredLang=([^;]+)/)?.[1] ||
  "es";
---

<section
  id="contact"
  data-section="contact"
  aria-label="Contact section"
  class="section bg-[#161512]/60 py-16 text-white"
>
  <div
    class="p-6 sm:p-10 md:p-16 lg:p-26 flex flex-col lg:flex-row gap-8 items-start lg:items-end justify-between bg-[#0b0b0b]/60"
  >
    <div class="w-full lg:w-[52%]">
      <Title
        class="text-center lg:text-left"
        text={t(lang, "pages.contact.title")}
      />
      <p class="mb-8 text-md text-justify">
        {t(lang, "pages.contact.description.text01")}
        <a
          id="dynamic-mail"
          class="cursor-pointer text-[#e9eeef]/60 underline hover:text-[#daa032] transition duration-300"
        >
          {t(lang, "pages.contact.email.placeholder") || "Enviar un correo"}
        </a>
        {t(lang, "pages.contact.description.text02")}
        <a
          href="https://www.linkedin.com/in/eloylozano"
          class="text-[#e9eeef]/60 underline hover:text-[#daa032] transition duration-300"
        >
          LinkedIn
        </a>. <br />{t(lang, "pages.contact.description.text03")}
      </p>
      <img
        src="/images/mockup.jpg"
        alt="Iphone With my portfolio"
        class="w-full rounded-md"
      />
    </div>

    <div class="w-full lg:w-[45%]">
      <form id="contact-form" class="rounded-md space-y-5">
        <div>
          <label for="name" class="block mb-2 text-sm"
            >{t(lang, "pages.contact.form.name.label")}</label
          >
          <input
            type="text"
            id="name"
            name="name"
            placeholder={t(lang, "pages.contact.form.name.placeholder")}
            required
            class="w-full rounded border-2 border-[#daa032] bg-[#161512] px-3 py-2 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#daa032] focus:shadow-[0_0_10px_2px_#daa032]"
          />
        </div>

        <div>
          <label for="email" class="block mb-2 text-sm"
            >{t(lang, "pages.contact.form.email.label")}</label
          >
          <input
            type="email"
            id="email"
            name="email"
            placeholder={t(lang, "pages.contact.form.email.placeholder")}
            required
            class="w-full rounded border-2 border-[#daa032] bg-[#161512] px-3 py-2 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#daa032] focus:shadow-[0_0_10px_2px_#daa032]"
          />
        </div>

        <div>
          <label for="message" class="block mb-2 text-sm"
            >{t(lang, "pages.contact.form.message.label")}</label
          >
          <textarea
            id="message"
            name="message"
            placeholder={t(lang, "pages.contact.form.message.placeholder")}
            required
            class="w-full h-40 resize-none rounded border-2 border-[#daa032] bg-[#161512] px-3 py-2 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#daa032] focus:shadow-[0_0_10px_2px_#daa032]"
          ></textarea>
        </div>

        <button
          type="submit"
          class="relative w-full inline-flex items-center justify-center rounded border-2 border-[#daa032] bg-[#161512] p-1 transition duration-300 group hover:scale-101 active:shadow-[0_0_10px_2px_#daa032]"
        >
          <span
            class="w-full h-full rounded-md bg-[#0b0b0b] px-4 py-2 text-white text-base font-medium transition-all duration-300"
          >
            {t(lang, "pages.contact.form.button")}
          </span>
        </button>
      </form>
    </div>
  </div>
</section>

<script>
  // Datos ofuscados para que los bots no los lean
  const u = "lozanobarrioseloy";
  const d = "gmail.com";
  const fullMail = `${u}@${d}`;

  function initContact() {
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const mailLink = document.getElementById("dynamic-mail");

    // 1. Configurar el enlace de texto para que funcione al click
    if (mailLink) {
      mailLink.addEventListener("click", () => {
        window.location.href = `mailto:${fullMail}?subject=Contacto`;
      });
    }

    // 2. Manejar el formulario
    form?.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);
      const name = formData.get("name") as string;
      const email = formData.get("email") as string;
      const message = formData.get("message") as string;

      if (!name || !email || !message) return;

      const subject = encodeURIComponent(`Mensaje de ${name} (Portfolio)`);
      const body = encodeURIComponent(
        `Nombre: ${name}\nEmail: ${email}\n\nMensaje:\n${message}`
      );

      // El mailto ahora lleva tu direcci√≥n reconstruida
      window.location.href = `mailto:${fullMail}?subject=${subject}&body=${body}`;
    });
  }

  initContact();
  document.addEventListener("astro:after-swap", initContact);
</script>
