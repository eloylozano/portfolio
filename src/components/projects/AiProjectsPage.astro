---

import { t } from "../../i18n";
import Subtitle from "../ui/Subtitle.astro";
import Text from "../ui/Text.astro";
import Title from "../ui/Title.astro";
const cookieHeader = Astro.request.headers.get("cookie") || "";
const lang = cookieHeader.match(/preferredLang=([^;]+)/)?.[1] || "es";
const {
  slug,
  gallery,
  demoLink,
  gitLink,
  tech,
  model, 
  dataset,   
  deployment, 
  stats,
} = Astro.props;

const tp = (key: string) => t(lang, `projects_data.${slug}.${key}`);

console.log('--- DEBUG I18N ---');
console.log('Idioma detectado:', lang);
console.log('Slug actual:', slug);
console.log('Resultado de t():', t(lang, `projects_data.${slug}.title`));
---
<section class="mx-auto px-4 lg:px-16 py-32 grid grid-cols-1 lg:grid-cols-2 gap-12">
  <div class="mySwiper swiper w-full aspect-video rounded-md overflow-hidden shadow-lg">
    <div class="swiper-wrapper">
      {gallery.map((img: string) => (
        <div class="swiper-slide">
          <img src={img} alt={tp("title")} class="w-full h-full object-cover" />
        </div>
      ))}
    </div>
    <div class="swiper-button-next text-[#daa032]"></div>
    <div class="swiper-button-prev text-[#daa032]"></div>
  </div>

  <div>
    <Title text={tp("title")} />
    <Text text={tp("description")} size="md" class="mb-6 text-justify" />

    {stats && (
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 my-8">
        {stats.map((stat: any) => (
          <div class="border border-[#daa032]/30 bg-[#161512] p-3 rounded-lg text-center">
            <p class="text-[#daa032] text-xl font-bold">{stat.value}</p>
            <p class="text-white/60 text-xs uppercase tracking-widest">{stat.label}</p>
          </div>
        ))}
      </div>
    )}

    <ul class="flex flex-wrap space-x-3 mt-6 text-sm text-white/80 list-none">
      {tech.map((item: any, index: number) => (
        <li class={`relative pl-3 before:absolute before:left-0 before:top-1/2 before:-translate-y-1/2 before:text-[#daa032] before:text-2xl font-semibold ${index === 0 ? "before:content-none pl-0" : "before:content-['Â·']"}`}>
          {item}
        </li>
      ))}
    </ul>

    <div class="flex items-center gap-6 mt-8">
      {gitLink && (
        <a href={gitLink} target="_blank" class="hover:scale-110 transition-transform">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 24 24">
            <path fill="#E9EEEF" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/>
          </svg>
        </a>
      )}
      <a href={demoLink} target="_blank" class="relative inline-flex items-center justify-center w-fit rounded border-2 border-[#daa032] bg-[#161512] p-1 transition duration-300 group hover:scale-105">
        <span class="rounded-md bg-[#0b0b0b] px-6 py-2 text-white text-sm font-medium transition-all group-hover:bg-[#111]">
          {tp("tryModel")}
        </span>
      </a>
    </div>
  </div>
</section>

<section class="space-y-32 px-4 lg:px-26 my-32 w-full mx-auto">
  {
    [
      { tech: model?.tech || [], title: tp("sections.model"), text: tp("content.model_text") },
      { tech: dataset?.tech || [], title: tp("sections.dataset"), text: tp("content.dataset_text") },
      { tech: deployment?.tech || [], title: tp("sections.deployment"), text: tp("content.deployment_text") },
    ]
    .map((section, index) => (
      <div class={`flex flex-col md:flex-row ${index % 2 !== 0 ? "md:flex-row-reverse" : ""} items-center justify-between gap-8`}>
        <div class="relative w-full md:w-5/6">
          <div class="neon-box border border-[#daa032] absolute inset-0 translate-x-5 -translate-y-7.5 z-0 hidden lg:block" />
          <article class="testimonial-card lg:bg-[#0b0b0b]/60 text-white relative z-10 border-sm p-8 lg:px-16 transition-all duration-500 w-full backdrop-blur-sm">
            <Subtitle text={section.title} gold />
            <Text text={section.text} class="mb-4 text-justify" />
            <ul class="flex flex-wrap gap-3 mt-6">
              {section.tech.map((t: string) => (
                <li class="px-3 py-1 bg-[#daa032]/10 border border-[#daa032]/40 rounded-full text-xs text-[#daa032] list-none">
                  {t}
                </li>
              ))}
            </ul>
          </article>
        </div>
      </div>
    ))
  }
</section>
<style>
  @keyframes neonPulse {
    0%,
    100% {
      box-shadow:
        0 0 6px #daa032,
        0 0 30px #daa032,
        inset 0 0 12px #daa032;
    }
    50% {
      box-shadow:
        0 0 6px #daa032,
        0 0 15px #daa032,
        inset 0 0 12px #daa032;
    }
  }

  .neon-box {
    animation: neonPulse 3s ease-in-out infinite;
    box-shadow:
      0 0 6px #daa032,
      0 0 30px #daa032,
      inset 0 0 8px #daa032;
  }

  .swiper-button-next,
  .swiper-button-prev {
    color: #daa032;
    text-shadow: 0 0 10px #daa03288;
    scale: 1.2;
  }

  .swiper-button-next::after,
  .swiper-button-prev::after {
    font-size: 1.5rem;
    font-weight: bold;
  }

  .swiper-pagination-bullet {
    background-color: #ffffff44 !important;
    opacity: 1 !important;
  }

  .swiper-pagination-bullet-active {
    background-color: #daa032 !important;
  }
</style>

<!-- Swiper script -->
<script type="module">
  import Swiper from "https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs";

  new Swiper(".mySwiper", {
    loop: true,
    autoplay: {
      delay: 3000,
    },
    spaceBetween: 10,
    centeredSlides: true,
    slidesPerView: 1,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
  });
</script>

<!-- Swiper styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
